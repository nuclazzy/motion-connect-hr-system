# **Supabaseì™€ Vercelì„ ì´ìš©í•œ Google ìº˜ë¦°ë” ì—°ë™ ê°€ì´ë“œ**

ì´ ë¬¸ì„œëŠ” Vercelì— ë°°í¬ëœ í”„ë¡ íŠ¸ì—”ë“œì™€ Supabase ë°±ì—”ë“œë¥¼ ì‚¬ìš©í•˜ì—¬ Google ìº˜ë¦°ë” ì—°ë™ ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ëŠ” ì „ì²´ ê³¼ì •ì„ ì•ˆë‚´í•©ë‹ˆë‹¤. Supabaseì˜ ë‚´ì¥ Authì™€ Edge Functionì„ í™œìš©í•˜ì—¬ ì§ì ‘ êµ¬í˜„í•´ì•¼ í•  ë°±ì—”ë“œ ì½”ë“œë¥¼ ìµœì†Œí™”í•˜ëŠ” ë° ì¤‘ì ì„ ë‘¡ë‹ˆë‹¤.

## **1ë‹¨ê³„: ì‚¬ì „ ì¤€ë¹„ (Google & Supabase ì„¤ì •)**

### **1.1. Google Cloud Console ì„¤ì •**

API ì‚¬ìš©ì„ ìœ„í•œ ì—´ì‡ (Credential)ë¥¼ ë°œê¸‰ë°›ëŠ” ê³¼ì •ì…ë‹ˆë‹¤.

1. **í”„ë¡œì íŠ¸ ìƒì„± ë° API í™œì„±í™”**:  
   * [Google Cloud Console](https://console.cloud.google.com/)ì—ì„œ ìƒˆ í”„ë¡œì íŠ¸ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.  
   * API ë° ì„œë¹„ìŠ¤ \> ë¼ì´ë¸ŒëŸ¬ë¦¬ì—ì„œ \*\*Google Calendar API\*\*ë¥¼ ê²€ìƒ‰í•˜ê³  \*\*ì‚¬ìš© ì„¤ì •\*\*í•©ë‹ˆë‹¤.  
2. **OAuth ë™ì˜ í™”ë©´ êµ¬ì„±**:  
   * API ë° ì„œë¹„ìŠ¤ \> OAuth ë™ì˜ í™”ë©´ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.  
   * User Typeì€ \*\*ì™¸ë¶€\*\*ë¡œ ì„ íƒí•˜ê³ , ì•± ì´ë¦„ ë“± í•„ìˆ˜ ì •ë³´ë¥¼ ì…ë ¥í•©ë‹ˆë‹¤.  
   * ë²”ìœ„(Scopes) ì„¤ì • ë‹¨ê³„ì—ì„œ ì„œë¹„ìŠ¤ì— í•„ìš”í•œ ìµœì†Œí•œì˜ ê¶Œí•œì„ ì¶”ê°€í•©ë‹ˆë‹¤.  
     * ìº˜ë¦°ë” ëª©ë¡ ì½ê¸°: https://www.googleapis.com/auth/calendar.readonly  
     * ìº˜ë¦°ë” ì´ë²¤íŠ¸ ì½ê¸°: https://www.googleapis.com/auth/calendar.events.readonly  
3. **ì‚¬ìš©ì ì¸ì¦ ì •ë³´(Credential) ìƒì„±**:  
   * API ë° ì„œë¹„ìŠ¤ \> ì‚¬ìš©ì ì¸ì¦ ì •ë³´ì—ì„œ \+ ì‚¬ìš©ì ì¸ì¦ ì •ë³´ ë§Œë“¤ê¸° \> \*\*OAuth í´ë¼ì´ì–¸íŠ¸ ID\*\*ë¥¼ ì„ íƒí•©ë‹ˆë‹¤.  
   * ì• í”Œë¦¬ì¼€ì´ì…˜ ìœ í˜•ì€ \*\*ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜\*\*ìœ¼ë¡œ ì„ íƒí•©ë‹ˆë‹¤.  
   * \*\*ìŠ¹ì¸ëœ ë¦¬ë””ë ‰ì…˜ URI\*\*ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.ğŸ“ ì¤‘ìš”: Supabaseê°€ ì œê³µí•˜ëŠ” ì „ìš© ì½œë°± URIë¥¼ ì •í™•íˆ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤.  
     https://\<YOUR\_SUPABASE\_PROJECT\_ID\>.supabase.co/auth/v1/callback  
   * ìƒì„±ëœ \*\*í´ë¼ì´ì–¸íŠ¸ ID\*\*ì™€ \*\*í´ë¼ì´ì–¸íŠ¸ ë³´ì•ˆ ë¹„ë°€\*\*ì„ ì•ˆì „í•œ ê³³ì— ë³µì‚¬í•´ ë‘¡ë‹ˆë‹¤.

### **1.2. Supabase í”„ë¡œì íŠ¸ ì„¤ì •**

Supabaseê°€ ì¸ì¦ê³¼ ë°ì´í„° ì €ì¥ì„ ëª¨ë‘ ì²˜ë¦¬í•˜ë„ë¡ ì„¤ì •í•©ë‹ˆë‹¤.

1. **Google Auth Provider í™œì„±í™”**:  
   * Supabase ëŒ€ì‹œë³´ë“œì—ì„œ Authentication \> Providersë¡œ ì´ë™í•©ë‹ˆë‹¤.  
   * **Google**ì„ ì„ íƒí•˜ê³  í™œì„±í™”í•©ë‹ˆë‹¤.  
   * Google Cloud Consoleì—ì„œ ë°œê¸‰ë°›ì€ \*\*í´ë¼ì´ì–¸íŠ¸ ID\*\*ì™€ \*\*í´ë¼ì´ì–¸íŠ¸ ë³´ì•ˆ ë¹„ë°€\*\*ì„ ë¶™ì—¬ë„£ìŠµë‹ˆë‹¤.  
   * **Scopes(ë²”ìœ„)** í•„ë“œì— Googleì—ì„œ ì„¤ì •í•œ ê²ƒê³¼ ë™ì¼í•œ ê¶Œí•œ ë²”ìœ„ë¥¼ ê³µë°±ìœ¼ë¡œ êµ¬ë¶„í•˜ì—¬ ì¶”ê°€í•©ë‹ˆë‹¤.  
     * https://www.googleapis.com/auth/calendar.readonly  
2. **(ì„ íƒ) ì¶”ê°€ ë°ì´í„° í…Œì´ë¸”**:  
   * Supabase Authê°€ í† í°ì„ ì„¸ì…˜ ë‚´ì— ìë™ìœ¼ë¡œ ê´€ë¦¬í•˜ë¯€ë¡œ, ì´ˆê¸° ë‹¨ê³„ì—ì„œëŠ” ë³„ë„ í…Œì´ë¸”ì´ í•„ìš” ì—†ìŠµë‹ˆë‹¤. í•„ìš”ì‹œ ì¶”í›„ì— ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## **2ë‹¨ê³„: í•µì‹¬ ì¸ì¦ êµ¬í˜„ (í”„ë¡ íŠ¸ì—”ë“œ at Vercel)**

Vercelì— ë°°í¬ëœ í”„ë¡ íŠ¸ì—”ë“œ(Next.js/React ë“±)ì—ì„œ Supabaseì˜ ë‚´ì¥ OAuth ê¸°ëŠ¥ì„ í˜¸ì¶œí•˜ì—¬ ì¸ì¦ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤.

### **2.1. Supabase í´ë¼ì´ì–¸íŠ¸ ì„¤ì •**

// lib/supabaseClient.js  
import { createClient } from '@supabase/supabase-js'

const supabaseUrl \= process.env.NEXT\_PUBLIC\_SUPABASE\_URL  
const supabaseAnonKey \= process.env.NEXT\_PUBLIC\_SUPABASE\_ANON\_KEY

export const supabase \= createClient(supabaseUrl, supabaseAnonKey)

### **2.2. ë¡œê·¸ì¸ ë²„íŠ¼ êµ¬í˜„**

ë²„íŠ¼ í´ë¦­ ì‹œ signInWithOAuth í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ëŠ” ê²ƒì´ ì „ë¶€ì…ë‹ˆë‹¤.

// components/LoginButton.jsx  
import { supabase } from '../lib/supabaseClient';

function LoginButton() {  
  async function handleGoogleLogin() {  
    const { error } \= await supabase.auth.signInWithOAuth({  
      provider: 'google',  
      options: {  
        scopes: 'https://www.googleapis.com/auth/calendar.readonly',  
        // ë¡œê·¸ì¸ í›„ ëŒì•„ì˜¬ í”„ë¡ íŠ¸ì—”ë“œ í˜ì´ì§€ ì£¼ì†Œ  
        redirectTo: \`${window.location.origin}/dashboard\`  
      }  
    });

    if (error) {  
      console.error('Google login error:', error.message);  
    }  
  }

  return \<button onClick={handleGoogleLogin}\>Google ìº˜ë¦°ë” ì—°ë™í•˜ê¸°\</button\>;  
}

export default LoginButton;

**ë™ì‘ ì›ë¦¬**: ì‚¬ìš©ìê°€ ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ Supabase ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ìë™ìœ¼ë¡œ êµ¬ê¸€ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë³´ëƒ…ë‹ˆë‹¤. ë¡œê·¸ì¸ ì™„ë£Œ í›„, êµ¬ê¸€ì€ Supabaseì˜ ì½œë°± URIë¡œ ì‚¬ìš©ìë¥¼ ë³´ë‚´ í† í° êµí™˜ì„ ì§„í–‰í•˜ê³ , ìµœì¢…ì ìœ¼ë¡œ redirectToì— ì§€ì •ëœ ì£¼ì†Œë¡œ ì‚¬ìš©ìë¥¼ ëŒë ¤ë³´ëƒ…ë‹ˆë‹¤. ì´ ëª¨ë“  ê³¼ì •ì´ ìë™ì…ë‹ˆë‹¤.

## **3ë‹¨ê³„: ìº˜ë¦°ë” ë°ì´í„° ìš”ì²­ (Supabase Edge Function)**

ì‚¬ìš©ìì˜ access\_tokenì„ ì‚¬ìš©í•˜ì—¬ Google APIë¥¼ í˜¸ì¶œí•˜ëŠ” ë¡œì§ì€ ë³´ì•ˆì„ ìœ„í•´ **Supabase Edge Function**ì—ì„œ ì‹¤í–‰í•©ë‹ˆë‹¤.

### **3.1. Edge Function ìƒì„± ë° ë°°í¬**

1. **CLIë¡œ í•¨ìˆ˜ ìƒì„±**:  
   supabase functions new get-google-calendars

2. **í•¨ìˆ˜ ì½”ë“œ ì‘ì„± (supabase/functions/get-google-calendars/index.ts)**:  
   import { serve } from 'https://deno.land/std@0.168.0/http/server.ts'  
   import { createClient } from 'https://esm.sh/@supabase/supabase-js@2'  
   import { google } from 'https://esm.sh/googleapis@105'

   serve(async (req) \=\> {  
     try {  
       // Edge Function ë‚´ì—ì„œ Supabase í´ë¼ì´ì–¸íŠ¸ ìƒì„±  
       const supabaseClient \= createClient(  
         Deno.env.get('SUPABASE\_URL') ?? '',  
         Deno.env.get('SUPABASE\_ANON\_KEY') ?? '',  
         { global: { headers: { Authorization: req.headers.get('Authorization')\! } } }  
       )

       // JWTë¥¼ í†µí•´ ì‚¬ìš©ì ì„¸ì…˜ ì •ë³´ ê°€ì ¸ì˜¤ê¸°  
       const { data: { session } } \= await supabaseClient.auth.getSession()

       // ì„¸ì…˜ì—ì„œ êµ¬ê¸€ access\_token ì¶”ì¶œ  
       const accessToken \= session?.provider\_token  
       if (\!accessToken) {  
         throw new Error('Google access token not found.')  
       }

       // Google API í´ë¼ì´ì–¸íŠ¸ ì„¤ì •  
       const auth \= new google.auth.OAuth2()  
       auth.setCredentials({ access\_token: accessToken })  
       const calendar \= google.calendar({ version: 'v3', auth })

       // ìº˜ë¦°ë” ëª©ë¡ ê°€ì ¸ì˜¤ê¸°  
       const res \= await calendar.calendarList.list({ maxResults: 10 })

       return new Response(JSON.stringify(res.data.items), {  
         headers: { 'Content-Type': 'application/json' },  
         status: 200,  
       })  
     } catch (error) {  
       return new Response(JSON.stringify({ error: error.message }), {  
         headers: { 'Content-Type': 'application/json' },  
         status: 400,  
       })  
     }  
   })

3. **í•¨ìˆ˜ ë°°í¬**:  
   supabase functions deploy get-google-calendars

## **4ë‹¨ê³„: í”„ë¡ íŠ¸ì—”ë“œì™€ ìµœì¢… ì—°ë™**

í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ë¡œê·¸ì¸ í›„, ë°°í¬ëœ Edge Functionì„ í˜¸ì¶œí•˜ì—¬ ìº˜ë¦°ë” ëª©ë¡ì„ ê°€ì ¸ì˜µë‹ˆë‹¤.

// pages/dashboard.jsx  
import { useEffect, useState } from 'react';  
import { supabase } from '../lib/supabaseClient';

function Dashboard() {  
  const \[calendars, setCalendars\] \= useState(\[\]);  
  const \[loading, setLoading\] \= useState(true);

  useEffect(() \=\> {  
    async function fetchCalendars() {  
      try {  
        setLoading(true);  
        // ë°°í¬ëœ Edge Function í˜¸ì¶œ  
        const { data, error } \= await supabase.functions.invoke('get-google-calendars');  
        if (error) throw error;  
        setCalendars(data);  
      } catch (error) {  
        console.error('Error fetching calendars:', error.message);  
      } finally {  
        setLoading(false);  
      }  
    }  
    fetchCalendars();  
  }, \[\]);

  if (loading) return \<p\>ìº˜ë¦°ë” ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...\</p\>;

  return (  
    \<div\>  
      \<h2\>ë‚´ êµ¬ê¸€ ìº˜ë¦°ë” ëª©ë¡\</h2\>  
      \<ul\>  
        {calendars.map(cal \=\> (  
          \<li key={cal.id}\>{cal.summary}\</li\>  
        ))}  
      \</ul\>  
    \</div\>  
  );  
}

export default Dashboard;

## **5ë‹¨ê³„: Vercel ë°°í¬ ë° í™˜ê²½ ë³€ìˆ˜ ì„¤ì •**

1. **Vercel í”„ë¡œì íŠ¸ ìƒì„±**: GitHub ë ˆí¬ì§€í† ë¦¬ë¥¼ Vercelì— ì—°ê²°í•©ë‹ˆë‹¤.  
2. **í™˜ê²½ ë³€ìˆ˜ ì„¤ì •**: Vercel í”„ë¡œì íŠ¸ì˜ Settings \> Environment Variablesì— ë‹¤ìŒì„ ì¶”ê°€í•©ë‹ˆë‹¤.  
   * NEXT\_PUBLIC\_SUPABASE\_URL: Supabase í”„ë¡œì íŠ¸ URL  
   * NEXT\_PUBLIC\_SUPABASE\_ANON\_KEY: Supabase í”„ë¡œì íŠ¸ anon key

ì´ ê³¼ì •ì„ í†µí•´ ê°œë°œìëŠ” ë³µì¡í•œ OAuth 2.0 ì½œë°± ì²˜ë¦¬ë‚˜ í† í° ê´€ë¦¬ë¥¼ ì§ì ‘ êµ¬í˜„í•  í•„ìš” ì—†ì´, Supabaseì™€ Vercelì„ í™œìš©í•˜ì—¬ ë¹ ë¥´ê³  ì•ˆì „í•˜ê²Œ êµ¬ê¸€ ìº˜ë¦°ë” ì—°ë™ ê¸°ëŠ¥ì„ êµ¬ì¶•í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.