<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Calendar ì—°ë™ í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
        }
        h1 { color: #333; }
        .status { 
            padding: 15px; 
            margin: 10px 0; 
            border-radius: 5px;
            background: #f5f5f5;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056b3; }
        #events { margin-top: 20px; }
        .event {
            border: 1px solid #ddd;
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <h1>ğŸ” Google Calendar API ì—°ë™ í…ŒìŠ¤íŠ¸</h1>
    
    <div id="status" class="status">
        <h3>í™˜ê²½ë³€ìˆ˜ ìƒíƒœ:</h3>
        <div id="env-status"></div>
    </div>

    <div>
        <button onclick="initializeAPI()">1. API ì´ˆê¸°í™”</button>
        <button onclick="authenticate()">2. ì¸ì¦í•˜ê¸°</button>
        <button onclick="fetchEvents()">3. ì´ë²¤íŠ¸ ê°€ì ¸ì˜¤ê¸°</button>
    </div>

    <div id="result" class="status" style="display:none;"></div>
    <div id="events"></div>

    <script>
        // í™˜ê²½ë³€ìˆ˜ (ì‹¤ì œ ê°’ìœ¼ë¡œ ì„¤ì •)
        const GOOGLE_CLIENT_ID = '241177742286-6kqma7m80ppcsl4m51ui9017eb48s8h1.apps.googleusercontent.com';
        const GOOGLE_API_KEY = 'AIzaSyBvOzRIgIjh8JSfZE2YZtVgNjPYGR3HWoM';
        const DISCOVERY_DOC = 'https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest';
        const SCOPES = 'https://www.googleapis.com/auth/calendar.readonly';
        
        // í…ŒìŠ¤íŠ¸í•  ìº˜ë¦°ë” ID
        const TEST_CALENDAR_ID = 'c_rb1oser82snsqf9vdkr7jgr9r8@group.calendar.google.com'; // íœ´ê°€ê´€ë¦¬ ìº˜ë¦°ë”

        let gapiInited = false;
        let gisInited = false;
        let tokenClient;

        // í˜ì´ì§€ ë¡œë“œ ì‹œ í™˜ê²½ë³€ìˆ˜ í™•ì¸
        window.onload = function() {
            const envStatus = document.getElementById('env-status');
            envStatus.innerHTML = `
                <p>âœ… API_KEY: ${GOOGLE_API_KEY ? 'ì„¤ì •ë¨' : 'âŒ ì—†ìŒ'}</p>
                <p>âœ… CLIENT_ID: ${GOOGLE_CLIENT_ID ? 'ì„¤ì •ë¨' : 'âŒ ì—†ìŒ'}</p>
                <p>ğŸ“… í…ŒìŠ¤íŠ¸ ìº˜ë¦°ë”: íœ´ê°€ê´€ë¦¬ ìº˜ë¦°ë”</p>
            `;
        };

        function showResult(message, type = 'info') {
            const resultDiv = document.getElementById('result');
            resultDiv.style.display = 'block';
            resultDiv.className = 'status ' + type;
            resultDiv.innerHTML = message;
        }

        async function initializeAPI() {
            showResult('ğŸ”„ Google API ì´ˆê¸°í™” ì¤‘...', 'info');
            
            // gapi ë¡œë“œ
            const script1 = document.createElement('script');
            script1.src = 'https://apis.google.com/js/api.js';
            script1.async = true;
            script1.defer = true;
            script1.onload = () => {
                gapi.load('client', async () => {
                    try {
                        await gapi.client.init({
                            apiKey: GOOGLE_API_KEY,
                            discoveryDocs: [DISCOVERY_DOC],
                        });
                        gapiInited = true;
                        showResult('âœ… Google API ì´ˆê¸°í™” ì„±ê³µ!', 'success');
                    } catch (error) {
                        showResult('âŒ API ì´ˆê¸°í™” ì‹¤íŒ¨: ' + error.message, 'error');
                    }
                });
            };
            document.body.appendChild(script1);

            // gis ë¡œë“œ
            const script2 = document.createElement('script');
            script2.src = 'https://accounts.google.com/gsi/client';
            script2.async = true;
            script2.defer = true;
            script2.onload = () => {
                tokenClient = google.accounts.oauth2.initTokenClient({
                    client_id: GOOGLE_CLIENT_ID,
                    scope: SCOPES,
                    callback: '', // ë‚˜ì¤‘ì— ì„¤ì •
                });
                gisInited = true;
            };
            document.body.appendChild(script2);
        }

        function authenticate() {
            if (!tokenClient) {
                showResult('âŒ ë¨¼ì € APIë¥¼ ì´ˆê¸°í™”í•´ì£¼ì„¸ìš”!', 'error');
                return;
            }

            tokenClient.callback = async (resp) => {
                if (resp.error !== undefined) {
                    showResult('âŒ ì¸ì¦ ì‹¤íŒ¨: ' + resp.error, 'error');
                    return;
                }
                showResult('âœ… ì¸ì¦ ì„±ê³µ! ì´ì œ ì´ë²¤íŠ¸ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.', 'success');
            };

            if (gapi.client.getToken() === null) {
                // í† í° ìš”ì²­ (íŒì—…ìœ¼ë¡œ ì¸ì¦)
                tokenClient.requestAccessToken({ prompt: 'consent' });
            } else {
                // ì´ë¯¸ ì¸ì¦ë¨
                tokenClient.requestAccessToken({ prompt: '' });
            }
        }

        async function fetchEvents() {
            if (!gapiInited || !gapi.client.getToken()) {
                showResult('âŒ ë¨¼ì € API ì´ˆê¸°í™”ì™€ ì¸ì¦ì„ ì™„ë£Œí•´ì£¼ì„¸ìš”!', 'error');
                return;
            }

            showResult('ğŸ”„ ìº˜ë¦°ë” ì´ë²¤íŠ¸ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘...', 'info');

            try {
                // ì´ë²ˆ ë‹¬ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
                const now = new Date();
                const timeMin = new Date(now.getFullYear(), now.getMonth(), 1).toISOString();
                const timeMax = new Date(now.getFullYear(), now.getMonth() + 1, 0).toISOString();

                const response = await gapi.client.calendar.events.list({
                    'calendarId': TEST_CALENDAR_ID,
                    'timeMin': timeMin,
                    'timeMax': timeMax,
                    'showDeleted': false,
                    'singleEvents': true,
                    'maxResults': 10,
                    'orderBy': 'startTime'
                });

                const events = response.result.items;
                
                if (events && events.length > 0) {
                    showResult(`âœ… ${events.length}ê°œì˜ ì´ë²¤íŠ¸ë¥¼ ì°¾ì•˜ìŠµë‹ˆë‹¤!`, 'success');
                    
                    let eventsHtml = '<h3>ğŸ“… íœ´ê°€ ì¼ì •:</h3>';
                    events.forEach(event => {
                        const start = event.start.date || event.start.dateTime;
                        eventsHtml += `
                            <div class="event">
                                <strong>${event.summary}</strong><br>
                                ë‚ ì§œ: ${start}<br>
                                ${event.description ? 'ì„¤ëª…: ' + event.description : ''}
                            </div>
                        `;
                    });
                    document.getElementById('events').innerHTML = eventsHtml;
                } else {
                    showResult('ğŸ“­ ì´ë²ˆ ë‹¬ì—ëŠ” ë“±ë¡ëœ íœ´ê°€ê°€ ì—†ìŠµë‹ˆë‹¤.', 'info');
                }
            } catch (error) {
                console.error('Error:', error);
                showResult('âŒ ì´ë²¤íŠ¸ ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨: ' + error.message, 'error');
            }
        }
    </script>
</body>
</html>